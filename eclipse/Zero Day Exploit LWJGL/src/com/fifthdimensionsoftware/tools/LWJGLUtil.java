package com.fifthdimensionsoftware.tools;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import org.newdawn.slick.Color;
import org.newdawn.slick.Graphics;
import org.newdawn.slick.Image;
import org.newdawn.slick.SlickException;
import org.newdawn.slick.fills.GradientFill;
import org.newdawn.slick.geom.Rectangle;
import org.newdawn.slick.util.BufferedImageUtil;

import com.fifthdimensionsoftware.display.ResourceUtil;
import com.fifthdimensionsoftware.display.lwjgl.ColorFill;
import com.fifthdimensionsoftware.display.lwjgl.RenderAction;
import com.fifthdimensionsoftware.game.ZeroDayExploit;

public class LWJGLUtil
{
	public static Image convertImage(BufferedImage param, String name)
	{
		try {
			return new Image(BufferedImageUtil.getTexture("name", param));
		} catch (IOException e) {
			return null;
		}
	}
	
	public static Image getImageFromRes(String image) throws SlickException
	{
		image += ".png";
		return new Image(ZipUtil.getStreamForFile("res.bin", image), image, false);
	}
	
	public static Color convertColor(java.awt.Color colorParam)
	{
		return new Color(colorParam.getRGB());
	}
	
	public static void drawGradient(Graphics g, Rectangle shape, Color color1, Color color2, Boolean vert)
	{
		if(vert)
			g.fill(shape, new GradientFill(0, 0, color1, 0, shape.getHeight(), color2, true));
		else
			g.fill(shape, new GradientFill(0, 0, color1, shape.getWidth(), 0, color2, true));
	}
	
	public static void drawBorderFade(Graphics g, Rectangle shape, Color color, int size)
	{
		//Top
		drawGradient(g, new Rectangle(shape.getX(), shape.getY()+size, shape.getWidth(), -size), Color.transparent, color, true);
		//Bottom
		drawGradient(g, new Rectangle(shape.getX(), shape.getHeight()-size, shape.getWidth(), size), Color.transparent, color, true);
		
		//Right
		drawGradient(g, new Rectangle(shape.getWidth()-size, shape.getY(), size, shape.getHeight()), Color.transparent, color, false);
		//Left
		drawGradient(g, new Rectangle(shape.getX()+size, shape.getY(), -size, shape.getHeight()), Color.transparent, color, false);
	}
	
	public static void drawPattern(Rectangle shape, Image pattern)
	{
		pattern.startUse();
		for(int x = 0; x<shape.getWidth(); x+=pattern.getWidth())
		{
			for(int y = 0; y<shape.getHeight(); y+=pattern.getHeight())
			{
				pattern.drawEmbedded(x, y, pattern.getWidth(), pattern.getHeight());
			}
		}
		pattern.endUse();
	}
	
	public static void drawImage(Rectangle geom, Image image)
	{
		image.startUse();
		image.drawEmbedded(geom.getX(), geom.getY(), geom.getWidth(), geom.getHeight());
		image.endUse();
	}
	
	public static Image preRenderPattern(Rectangle geom, Image pattern) throws SlickException
	{
		Image toReturn = new Image((int)geom.getWidth(), (int)geom.getHeight());
		for(int x = 0; x<geom.getWidth(); x+=pattern.getWidth())
		{
			for(int y = 0; y<geom.getHeight(); y+=pattern.getHeight())
			{
				toReturn.getGraphics().drawImage(pattern, x, y);
			}
		}
		return toReturn;
	}
	
	private static float fadeTick = 0;
	private static boolean goUp = true;
	
	public static void doNextFadeTick(Rectangle geom, Image image, String actionName, float tickRate, int sleepTime)
	{
		if(goUp)
		{
			if(fadeTick >= 1.0){
				goUp = false;
				try {
					Thread.sleep(sleepTime);
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}else
				fadeTick+=tickRate;
		}else
		{
			if(fadeTick <= 0.0){
				goUp = true;
				ZeroDayExploit.getRootWindow().removeActionFromQueue(actionName);
				fadeTick = 0;
				if(ZeroDayExploit.getRootWindow().clearOnFadeFinish){
					ZeroDayExploit.getRootWindow().clearOnFadeFinish = false;
					ZeroDayExploit.verifyAndBoot();
				}
				return;
			}else
				fadeTick-=tickRate;
		}
		
		image.setColor(0, 1, 1, 1, fadeTick);
		image.setColor(1, 1, 1, 1, fadeTick);
		image.setColor(2, 1, 1, 1, fadeTick);
		image.setColor(3, 1, 1, 1, fadeTick);
		
		drawImage(geom, image);
	}
	
	public static void drawWindowQueue(String windowName)
	{
		try {
			for(RenderAction action : ZeroDayExploit.getRootWindow().windowMan.getWindow(windowName).getQueue())
				action.execute();
			ZeroDayExploit.getRootWindow().windowMan.getWindow(windowName).renderFinal.execute();
		} catch (Exception e)
		{
			System.err.println("Invalid queue removal occured in window queue!");
		}
	}
	
	public static Image getResource(boolean res, String name)
	{
		if(ResourceUtil.getResource(name+".png") != null)
			return ResourceUtil.getResource(name+".png").asImage;
		if(res)
		{
			ResourceUtil.loadResourceFromRes(name+".png", false);
			return ResourceUtil.getResource(name+".png").asImage;
		}else
		{
			ResourceUtil.loadResource(new File(ZeroDayExploit.filterPath("disk", name, "png")), false);
			return ResourceUtil.getResource(name+".png").asImage;
		}
	}
	
	public static void fillRect(Graphics g, Rectangle rect, Color color)
	{
		g.draw(rect, new ColorFill(color));
	}
}
