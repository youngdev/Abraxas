package com.fifthdimensionsoftware.game;

import java.io.File;
import java.io.IOException;
import java.util.Scanner;

import com.fifthdimensionsoftware.asm.ArmCore;
import com.fifthdimensionsoftware.asm.BIOS;

public class ZeroDayExploit
{
	public static void main(String[] args)
	{
		try {
			//Load the first 512 bytes (128 integers) into memory
			new ArmCore("disks/diskFile", args).loadDiskRegion(0, 128, 0);
			BIOS.init();
			Scanner scan = new Scanner(new File("progFile.asm"));
			int lastPos = 0;
			while(scan.hasNextLine())
			{
				String line = scan.nextLine();
				if(!line.trim().isEmpty() && !line.trim().startsWith(";"))
				{
					lastPos += ArmCore.lastStrSize + (ArmCore.lastStrSize > 0 ? 1 : 0);
					ArmCore.getInstance().loadStringToMemory(line.trim(), lastPos);
				}
			}
			scan.close();
			
			ArmCore.getInstance().saveDiskRegion(0, 128, 0);
		} catch (IOException e)
		{
			ArmCore.logEvent(true, false, "LoadDisk", "An IOException occurred while loading the boot sector.");
			e.printStackTrace();
		}
		
		ArmCore.getInstance().forceAccessLevel(0, 128, Byte.MAX_VALUE);
		ArmCore.getInstance().doExecution(0);
	}
}
