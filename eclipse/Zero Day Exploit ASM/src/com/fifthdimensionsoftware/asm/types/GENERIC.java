package com.fifthdimensionsoftware.asm.types;

import com.fifthdimensionsoftware.asm.ArmCore;

public class GENERIC extends ARG
{
	public GENERIC(String argData)
	{
		super(argData);
		if(!this.isString())
			this.argData = this.argData.toUpperCase();
	}

	@Override
	public int resolveArgument() 
	{
		for(ArgTypes type : ArgTypes.values())
		{
			if(type != ArgTypes.ARG && type.verifyType(argData))
			{
				switch(type.name())
				{
				case "REG":
					return ArmCore.getInstance().getRegister(Integer.parseInt(this.argData.replace("R", "")));
				case "MEM":
					return ArmCore.getInstance().getMemory(Integer.parseInt(argData.replace("[", "").replace("]", "")));
				case "IMM":
					return Integer.parseInt(argData.replace("#", ""));
				case "STR":
					return argData.length();
				case "VAR":
					return ArmCore.getInstance().getVar(argData.replace("^", "")).resolveArgument();
				case "MEMVAR":
					return ArmCore.getInstance().getMemory(ArmCore.getInstance().getVar(argData.replace("^", "").replace("[", "").replace("]", "")).resolveArgument());
				case "BIN":
					return Integer.parseInt(argData.replace("0B", "").replace("_", ""), 2);
				case "HEX":
					return Integer.parseInt(argData.replace("0X", "").replace("_", ""), 16);
				case "MEMBIN":
					return ArmCore.getInstance().getMemory(Integer.parseInt(argData.replace("0B", "").replace("[", "").replace("]", "").replace("_", ""), 2));
				case "MEMHEX":
					return ArmCore.getInstance().getMemory(Integer.parseInt(argData.replace("0X", "").replace("[", "").replace("]", "").replace("_", ""), 16));
				case "MEMLABEL":
					return new MEM(this.argData).resolveArgument();
				}
			}
		}
		return 0;
	}
	
	public String resolveString()
	{
		return !this.isLiteral() ? (this.isString() ? this.argData.replace("\"", "") : this.resolveArgument() + "") : this.argData + " ("+this.resolveArgument()+")";
	}
	
	public boolean isString()
	{
		return ArgTypes.STR.verifyType(argData);
	}
	
	public boolean isLiteral()
	{
		return ArgTypes.BIN.verifyType(argData) || ArgTypes.HEX.verifyType(argData);
	}
}
enum ArgTypes
{
	REG ("^R\\d?\\d"),
	ARG (".+"),
	MEM ("^\\[\\d+\\]$"),
	IMM ("^#\\d+"),
	STR ("\\\".+\\\""),
	VAR ("\\^.+"),
	MEMVAR ("^\\[\\^.+\\]$"),
	BIN ("0B\\d+"),
	HEX ("0X.+"),
	MEMBIN ("^\\[0B.+\\]$"),
	MEMHEX ("^\\[0X.+\\]$"),
	MEMLABEL ("^\\[:.+\\]$"),
	;
	
	private String regex = "";
	
	private ArgTypes(String regParam)
	{
		this.regex = regParam;
	}
	
	public boolean verifyType(String arg)
	{
		return arg.matches(this.regex);
	}
}