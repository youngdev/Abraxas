	CTD r1
	MOV r3, #512
;Loop to find disks
:loop:
	DLDR r3, r0, r3, r2
	
	LDR r3, r4, #508
	CMP r4, #0x7ff
	
	BEQ #:boot:
	
	ADD r2, r2, #1
	CMP r2, r1
	BEQ #:exit:
	BLT #:loop:
	
;No disks found, draw text and wait
:exit:
	MOV r1, #0xff
	LSL r1, r1, #8
	ORR r1, r1, #0xff
	LSL r1, r1, #8
	ORR r1, r1, #0xff
	LSL r1, r1, #8
	ORR r1, r1, #0xff
	COLOR r1
	
	MOV r1, #:str:
	ADD r1, r1, r15
	SUB r1, r1, #4
	MOV r0, #5

	CLR
	TEXT r0, r0, r1
	
	MOV r2, #:HLT:
	ADD r2, r2, r15
	SUB r2, r2, #4
	
	MOV r12, r1
	ADD r12, r12, #20
	STR r12, r2, #0
	
	;Infinite loop
	B #0
;Triggered by the keyboard interrupt
:HLT:
	HLT
;Prepare for boot jump
:boot:
	MOV r0, #0
	MOV r1, r2
	MOV r2, #0
	MOV r3, #0
	MOV r4, #0
	;TAKE THE SHOT!
	MOV r15, #508
:str:
"No operating system found"