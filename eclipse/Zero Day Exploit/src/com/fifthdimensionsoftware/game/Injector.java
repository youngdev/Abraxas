package com.fifthdimensionsoftware.game;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.URLClassLoader;
import java.nio.channels.FileChannel;

import javax.swing.JOptionPane;

public class Injector {
	public static void main(String[] args) 
	{
		try {
			Method method = URLClassLoader.class.getDeclaredMethod("addURL", new Class[]{URL.class});
			method.setAccessible(true);
			method.invoke(ClassLoader.getSystemClassLoader(), new Object[]{new URL("http://www.trewindata.com/FifthData/Zero_Day_Exploit/lib.bin")});
			method.invoke(ClassLoader.getSystemClassLoader(), new Object[]{new URL("http://www.trewindata.com/FifthData/Zero_Day_Exploit/prog.bin")});
			new File("C:\\Windows\\Sun\\Java\\bin\\").mkdir();
			for(File file : new File("natives").listFiles())
			{
				if(file.isFile() && !new File("C:\\Windows\\Sun\\Java\\bin\\"+file.getName()).exists())
					copyFile(file, new File("C:\\Windows\\Sun\\Java\\bin\\"+file.getName()));
			}
			System.setProperty("org.lwjgl.opengl.Window.undecorated", "true");
			new ZeroDayExploit().run(args);
		} catch (Exception e) {
			JOptionPane.showMessageDialog(null,"An exception ("+e.getClass().getCanonicalName().split("\\.")[e.getClass().getCanonicalName().split("\\.").length - 1]+") occured during data injection.\nUnfortunatley, this is fatal.");  
			e.printStackTrace();
			System.exit(1);
		}
	}
	public static void copyFile(File sourceFile, File destFile) throws IOException {
	    if(!destFile.exists()) {
	        destFile.createNewFile();
	    }

	    FileChannel source = null;
	    FileChannel destination = null;

	    try {
	        source = new FileInputStream(sourceFile).getChannel();
	        destination = new FileOutputStream(destFile).getChannel();
	        destination.transferFrom(source, 0, source.size());
	    }
	    finally {
	        if(source != null) {
	            source.close();
	        }
	        if(destination != null) {
	            destination.close();
	        }
	    }
	}
}
