package com.fifthdimensionsoftware.game;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.zip.ZipFile;

public class ZipHandler 
{
	
	private static HashMap<String, ZipFile> zipFiles = new HashMap<String, ZipFile>();
	
	static
	{
		try {
			zipFiles.put("res.dat", new ZipFile("res.dat"));
		} catch (IOException e) {
			ZeroDayExploit.throwFatal("An error occured loading res.dat!");
		}
	}
	
	public static InputStream getStreamForFile(String zipFile, String file)
	{
		InputStream toReturn = null;
		if(!new File(zipFile.split("\\.")[0]+"/"+file).exists())
		{
			if(!zipFiles.containsKey(zipFile))
				prepareZip(zipFile);
			ZipFile zipObj = zipFiles.get(zipFile);
			try {
				toReturn = zipObj.getInputStream(zipObj.getEntry(file));
			} catch (IOException e) {
				e.printStackTrace();
			}
		}else
		{
			try {
				System.err.println("Local version of "+file+" used");
				toReturn = new FileInputStream(new File(zipFile.split("\\.")[0]+"/"+file));
			} catch (FileNotFoundException e) {
				e.printStackTrace();
			}
		}
		return toReturn;
	}
	
	public static void prepareZip(String archive)
	{
		if(!zipFiles.containsKey(archive))
			try {
				zipFiles.put(archive, new ZipFile(archive));
			} catch (IOException e) {
				ZeroDayExploit.throwFatal("An error occured loading "+archive+"!");
			}
	}
}
