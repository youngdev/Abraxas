package net.lotrek.zero.graphics;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Arrays;

import net.lotrek.zero.Abraxas;
import net.lotrek.zero.tools.FBOUtil;

import org.lwjgl.opengl.Display;

public class RenderAction<T>
{
	private Method toInvoke;
	private Object[] arguments;
	private T subject;
	private boolean doubleRender;
	
	public RenderAction(Method method, T subject, boolean doubleLayer, Object...args)
	{
		this.arguments = args;
		this.toInvoke = method;
		this.subject = subject;
		this.doubleRender = doubleLayer;
	}
	
	public void invoke()
	{
		if(Abraxas.getKey("--trace") || Abraxas.getKey("--traceAll"))
			System.out.println(toInvoke.getName() + " : " +  subject + " : " + Arrays.toString(arguments));
		
		try {
			this.toInvoke.invoke(this.subject, this.arguments);
			if (doubleRender && !FBOUtil.isFBOSupported()) {
				Display.update();
				this.toInvoke.invoke(this.subject, this.arguments);
				Display.update();
			}
		} catch (IllegalAccessException | IllegalArgumentException
				| InvocationTargetException e) {
			e.printStackTrace();
		}
	}
	
	public String getName()
	{
		return toInvoke.getName();
	}
	
	public String toString()
	{
		return this.getName();
	}
}
